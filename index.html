<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bodega Tech Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    
    <style>
        :root { --p: #1e293b; --a: #2563eb; --s: #22c55e; }
        body { font-family: sans-serif; margin: 0; background: #f1f5f9; }
        .hidden { display: none !important; }
        nav { background: var(--p); color: white; padding: 15px; display: flex; justify-content: space-between; }
        .container { padding: 15px; max-width: 500px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input, button, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 5px; border: 1px solid #ddd; box-sizing: border-box; }
        button { background: var(--a); color: white; border: none; font-weight: bold; cursor: pointer; }
        canvas { border: 1px dashed #ccc; width: 100%; height: 180px; background: #fff; }
    </style>
</head>
<body>

<nav id="navbar" class="hidden">
    <span>ðŸ“¦ Bodega Tech</span>
    <button onclick="location.reload()" style="width:auto; background:red; padding:5px 10px;">Salir</button>
</nav>

<div class="container">
    <div id="view-login" class="card">
        <h2>Ingreso Bodega</h2>
        <input type="email" id="email" placeholder="admin@tech.com">
        <input type="password" id="pass" placeholder="ContraseÃ±a">
        <button onclick="login()">Entrar</button>
    </div>

    <div id="view-admin" class="hidden">
        <div class="card">
            <h3>Registrar Equipo</h3>
            <input type="text" id="p-nom" placeholder="Nombre Equipo">
            <input type="number" id="p-stock" placeholder="Stock Inicial">
            <input type="date" id="p-fecha">
            <select id="p-gar">
                <option value="12">12 Meses</option>
                <option value="24">24 Meses</option>
            </select>
            <button onclick="guardarProducto()" style="background:var(--s)">Guardar y Generar QR</button>
            <div id="qrcode" style="display:flex; justify-content:center; margin-top:10px;"></div>
        </div>
    </div>

    <div id="view-op" class="hidden">
        <div class="card">
            <h3>Salida de Equipo</h3>
            <button onclick="escanear()">ðŸ“· Escanear QR</button>
            <div id="reader"></div>
            <div id="form-firma" class="hidden">
                <p>Equipo: <b id="out-nom"></b></p>
                <input type="number" id="out-cant" placeholder="Cantidad">
                <canvas id="canvas"></canvas>
                <button onclick="firmar()" style="background:var(--s)">Confirmar Entrega</button>
            </div>
        </div>
    </div>
</div>

<script type="module">
    // --- PEGA TUS LLAVES DE FIREBASE AQUÃ ---
    const firebaseConfig = {
      apiKey: "TU_API_KEY",
      authDomain: "TU_PROYECTO.firebaseapp.com",
      projectId: "TU_PROYECTO",
      storageBucket: "TU_PROYECTO.appspot.com",
      messagingSenderId: "TU_ID",
      appId: "TU_APP_ID"
    };

    // Inicializar Firebase (Simulado para el ejemplo local)
    // En tu versiÃ³n real, descomenta las lÃ­neas de importaciÃ³n de Firebase
    
    window.login = function() {
        const u = document.getElementById('email').value;
        if(u.includes('admin')) { show('view-admin'); } 
        else { show('view-op'); initFirma(); }
        document.getElementById('navbar').classList.remove('hidden');
    }

    function show(id) {
        ['view-login', 'view-admin', 'view-op'].forEach(v => document.getElementById(v).classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    window.guardarProducto = function() {
        const id = "ID-" + Date.now();
        const nom = document.getElementById('p-nom').value;
        // LÃ³gica de guardado en Firebase aquÃ­
        document.getElementById('qrcode').innerHTML = "";
        new QRCode(document.getElementById("qrcode"), { text: id, width: 128, height: 128 });
        alert("Guardado: " + nom);
    }

    window.escanear = function() {
        const scanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });
        scanner.render((text) => {
            document.getElementById('form-firma').classList.remove('hidden');
            document.getElementById('out-nom').innerText = "Equipo Detectado";
            scanner.clear();
        });
    }

    function initFirma() {
        window.pad = new SignaturePad(document.getElementById('canvas'));
    }

    window.firmar = function() {
        if(window.pad.isEmpty()) return alert("Falta firma");
        alert("Entrega registrada correctamente");
        location.reload();
    }
</script>
</body>
</html>

